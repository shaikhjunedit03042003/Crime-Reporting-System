<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{admin/admin-base::layout(~{::section})}">
<head>
<meta charset="UTF-8">
<title th:text="${title}"></title>

</head>
<body>
	<section
		class="banner d-flex justify-content-center align-items-center">

		<div class="container"
			style="margin-top: 20px; height: 100%; width: 100%; background-color: white;">

			<div class="container text-center" id="box1">
				<div class="container mt-5">
					<h1 style="color: blue;">Manage Complaints</h1>
					<!-- Success/Error Messages -->
					<div th:if="${successMessage}" class="alert alert-success"
						th:text="${successMessage}"></div>
					<div th:if="${errorMessage}" class="alert alert-danger"
						th:text="${errorMessage}"></div>


					<div class="row mb-3">
						<div class="col-md-4">
							<input type="text" class="form-control" id="search"
								placeholder="Search by title or crime type..."
								onkeyup="filterTable()">
						</div>
					</div>

					<!-- Complaints Table -->
					<table id="complaintsTable">
						<thead>
							<tr>
								<th>ID</th>
								<th>Title</th>
								<th>Crime Type</th>
								<th>Location</th>
								<th>Police Station</th>
								<th>Status</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="complaint : ${complaints}">
								<td th:text="${complaint.id}"></td>
								<td th:text="${complaint.title}"></td>
								<td th:text="${complaint.crimeType}"></td>
								<td th:text="${complaint.location}"></td>
								<td th:text="${complaint.policeStation}"></td>
								<td><span th:text="${complaint.status}"
									th:class="${complaint.status == 'PENDING' ? 'badge bg-warning' :
                     complaint.status == 'ASSIGNED' ? 'badge bg-info' :
                     complaint.status == 'IN_PROGRESS' ? 'badge bg-primary' :
                     complaint.status == 'RESOLVED' ? 'badge bg-success' :
                     'badge bg-danger'}"></span>
								</td>

								<td><a
									th:href="@{/onlinecrimereportingsystem/admin/view/{id}(id=${complaint.id})}"
									class="btn btn-sm btn-info">View Details</a></td>
							</tr>
						</tbody>
					</table>


				</div>
			</div>
		</div>

		<script>
        function filterTable() {
            const input = document.getElementById("search").value.toLowerCase();
            const table = document.getElementById("complaintsTable");
            const rows = table.getElementsByTagName("tr");
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName("td");
                let match = false;
                for (let j = 0; j < cells.length; j++) {
                    if (cells[j].textContent.toLowerCase().includes(input)) {
                        match = true;
                        break;
                    }
                }
                rows[i].style.display = match ? "" : "none";
            }
        }
    </script>

	</section>
</body>
</html>